<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Convert to Public Dropbox Link</title>
</head>
<body>
	<form>
		<input id="db_link" type="text">
		<a href="#" onclick="process_submission();">Convert!</a>
		<input type="text" id="public_link" disabled>
	</form>

	<script>
	function process_submission() {
		var db_link = document.getElementById('db_link').value;

		unshorten_link(db_link);
	}

	function unshorten_link(link) {
		console.log("AJAX Function Called");
		xmlhttp = new XMLHttpRequest();

		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				console.log("Good AJAX Reply");
				var expanded_link = xmlhttp.responseText.resolvedURL;

				var file_name = expanded_link.substring(db_link.lastIndexOf("/") + 1);

				document.getElementById('public_link').value = "https://dl.dropboxusercontent.com/u/9296799/TheGIFFile/" + file_name;
			}
		}

		xmlhttp.open("GET", "http://api.unshort.me/unshorten?r=" + link + "&api_key=9059e112be00a40606e7e16162e10e9a", true);
		xmlhttp.send();
	}
	</script>
</body>
</html>